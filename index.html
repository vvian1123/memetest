<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MemeMaster è„‘éƒ¨CTæ‰«æ</title>
    <style>
        body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
        .box { border: 1px solid #333; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        h3 { color: #fff; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .item { margin-bottom: 5px; color: #ccc; }
        .highlight { color: #ff0; font-weight: bold; }
        button { background: #333; color: #fff; border: 1px solid #fff; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ§  AI è„‘éƒ¨å®æ—¶ç›‘æ§ (Debug Mode)</h1>
    <button onclick="load()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    <span id="status">è¿æ¥ä¸­...</span>

    <div class="box">
        <h3>ğŸ“Œ å°çº¸æ¡ (Sticky Notes) - ç»å¯¹è§„åˆ™</h3>
        <div id="sticky"></div>
    </div>

    <div class="box">
        <h3>ğŸ§© æœ€æ–°è®°å¿†ç¢ç‰‡ (Fragments) - RAGæ£€ç´¢æ± </h3>
        <div id="frags"></div>
    </div>

    <div class="box">
        <h3>ğŸ–¼ï¸ è¡¨æƒ…åŒ…ç´¢å¼• (Memes) - è§†è§‰åº“</h3>
        <div>æ€»æ•°: <span id="meme_count" class="highlight">0</span></div>
        <div>æœ€æ–°å…¥åº“: <span id="last_meme"></span></div>
    </div>

    <div class="box">
        <h3>âš™ï¸ ç³»ç»Ÿé…ç½®</h3>
        <pre id="config"></pre>
    </div>

    <script>
        const token = new URLSearchParams(location.search).get("token");

        async function load() {
            document.getElementById('status').innerText = 'æ­£åœ¨è¯»å–...';
            try {
                let r = await fetch(`/api/get_data?token=${token}`);
                if(r.status !== 200) throw new Error("Tokené”™è¯¯");
                let data = await r.json();

                // æ¸²æŸ“å°çº¸æ¡
                document.getElementById('sticky').innerHTML = data.sticky.length 
                    ? data.sticky.map(s => `<div class="item">ğŸ“Œ ${s}</div>`).join('') 
                    : '<div style="color:#666">ç©ºç©ºå¦‚ä¹Ÿ</div>';

                // æ¸²æŸ“æœ€æ–°5æ¡è®°å¿†
                let lastFrags = data.frags.slice(-5).reverse();
                document.getElementById('frags').innerHTML = lastFrags.length
                    ? lastFrags.map(f => `<div class="item">[${f.time}] <span class="highlight">${f.content}</span> <br>Key: ${f.keywords}</div>`).join('')
                    : '<div style="color:#666">è¿˜æ²¡å¼€å§‹èŠå¤©</div>';

                // æ¸²æŸ“è¡¨æƒ…æ•°æ®
                let keys = Object.keys(data.memes);
                document.getElementById('meme_count').innerText = keys.length;
                if(keys.length > 0) {
                    let lastKey = keys[keys.length-1];
                    let lastVal = data.memes[lastKey];
                    document.getElementById('last_meme').innerText = `${lastVal.tags} (${lastVal.source})`;
                }

                // æ¸²æŸ“é…ç½®
                document.getElementById('config').innerText = JSON.stringify(data.config, null, 2);
                document.getElementById('status').innerText = 'âœ… æ•°æ®å·²åŒæ­¥';
            } catch(e) {
                document.getElementById('status').innerText = 'âŒ è¿æ¥å¤±è´¥: ' + e;
            }
        }
        load();
    </script>
</body>
</html>
